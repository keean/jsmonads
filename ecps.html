<!DOCTYPE html>
<html lang="en">
<head>
    <title>Monads in JavaScript</title>
</head>
<body>
<div id="display" style="white-space:pre-wrap"></div>
<script src="monads.js"></script>
<script>

    var succ = function(a) {
        document.getElementById('display').textContent += "SUCC " + a + "\n";
    };

    var fail = function(e) {
        document.getElementById('display').textContent += "FAIL " + e + "\n";
    };

    var fun = function(a) {
        return new Ecps(function(succ, fail) {
            document.getElementById('display').textContent += "DONE " + a + "\n";
            if (a < 10) {
                setTimeout(function() {succ(a + 1);}, 0);
            } else {
                setTimeout(function() {fail(a);}, 0);
            }
        });
    };

    var prog = fun(5)
        .bind(fun)
        .bind(fun)
        .bind(fun)
        .bind(fun)
        .bind(fun)
        .bind(fun);

    prog.run(succ, fail);

    var prog2 = fun(1).bind(function(x) {
        return fun(x).bind(function(y) {
            return fun(x + y).bind(function(z) {
                return fun(x + y + z);
            })
        })
    });

    prog2.run(succ, fail);

</script>
</script>
</body>
</html>
